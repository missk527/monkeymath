<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MonkeyMath ‚Äî Forest Adventure (Single File)</title>
<style>
  :root{ --ink:#064663; --accent:#ffd54f; --green:#4caf50; --card:rgba(255,255,255,.95);}
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Poppins","Comic Sans MS",system-ui,Arial;
    color:var(--ink); text-align:center; overflow-x:hidden;
    background: linear-gradient(180deg,#fff6b7 0%, #a0e9ff 60%);
    transition: background .6s ease;
  }
  header{padding:14px 10px; font-weight:900; font-size:clamp(22px,3.6vw,34px);}
  .card{width:min(860px,92vw); margin:10px auto 28px; background:var(--card); border-radius:22px;
    box-shadow:0 10px 30px rgba(0,0,0,.15); padding:16px 16px 20px; position:relative; overflow:hidden;}
  .row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;align-items:center;margin:6px 0;}
  select,button,input[type="text"],input[type="number"]{
    font-size:16px; padding:10px 12px; border:none; border-radius:12px; background:#fff;
    box-shadow:0 2px 0 rgba(0,0,0,.07);
  }
  button{background:var(--accent); color:#2b3a42; font-weight:800; cursor:pointer;}
  .character img{width:min(60vw,220px); height:auto; transition:transform .25s ease;}
  .question{font-size:clamp(24px,4.2vw,42px); margin:10px 0 4px;}
  .hud{font-size:15px; margin:6px 0 10px;}
  .bar{height:20px;background:#e9eef3;border-radius:16px;overflow:hidden;margin:8px 0 12px}
  .fill{height:100%;width:0%;background:var(--green);transition:width .25s ease;}
  .enc{min-height:1.6em;color:#0b8a27;font-size:18px;margin:8px 0}
  .board{margin-top:14px;text-align:left}
  .board h3{text-align:center;margin:6px 0}
  .board table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden}
  .board th,.board td{padding:8px;border-bottom:1px solid #eee;text-align:center;font-size:14px}
  .confetti{position:absolute;width:10px;height:10px;top:0;left:50%;opacity:.85;border-radius:2px;animation:fall 1.4s linear forwards}
  @keyframes fall{to{transform:translateY(520px) rotate(360deg);opacity:0}}
  .toast{position:absolute;left:50%;top:10px;transform:translateX(-50%) translateY(-20px);background:rgba(0,0,0,.65);color:#fff;padding:8px 14px;border-radius:999px;font-size:14px;opacity:0;transition:all .35s ease;pointer-events:none}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
  body.scene-0{background:linear-gradient(180deg,#fff6b7 0%, #a0e9ff 60%);}
  body.scene-1{background:linear-gradient(180deg,#f3ffb7 0%, #7fd7ee 60%);}
  body.scene-2{background:linear-gradient(180deg,#d4f8a3 0%, #66c6df 60%);}
  body.scene-3{background:linear-gradient(180deg,#b7eb8f 0%, #54bada 60%);}
  body.scene-4{background:linear-gradient(180deg,#a0e090 0%, #44b0d4 60%);}
  @media (max-width:480px){ .row select,.row input,.row button{width:100%} .character img{width:70vw} }
</style>
</head>
<body class="scene-0">
  <header>MonkeyMath üêæ ‚Äî Forest Adventure</header>
  <div class="card" id="card">
    <div class="row">
      <label for="player">Your name:</label>
      <input id="player" type="text" placeholder="Enter your name" />
    </div>
    <div class="row">
      <label>Operation:</label>
      <select id="op">
        <option value="add">Addition</option>
        <option value="sub">Subtraction</option>
        <option value="mul">Multiplication</option>
        <option value="div">Division</option>
      </select>
      <label>Difficulty:</label>
      <select id="diff">
        <option value="easy">Easy (1-digit)</option>
        <option value="medium">Medium (2-digit)</option>
        <option value="hard">Hard (3-digit)</option>
      </select>
      <label>Time:</label>
      <select id="time">
        <option value="60">1 min</option>
        <option value="120">2 min</option>
        <option value="300">5 min</option>
      </select>
    </div>
    <div class="row"><button id="start">Start Game</button></div>
    <div class="character"><img id="pet" alt="Character"></div>
    <div class="hud">‚è≥ Time: <span id="t">0</span>s &nbsp;|&nbsp; ‚≠ê Score: <span id="s">0</span></div>
    <div class="bar"><div class="fill" id="fill"></div></div>
    <div class="question" id="q">Press Start!</div>
    <div class="row">
      <input id="ans" type="number" placeholder="Your answer" />
      <button id="submit">Submit</button>
    </div>
    <div class="enc" id="enc"></div>
    <div class="board">
      <h3>üèÜ Leaderboard (Top 10)</h3>
      <table>
        <thead><tr><th>Rank</th><th>Name</th><th>Score</th></tr></thead>
        <tbody id="lb"></tbody>
      </table>
    </div>
    <div class="toast" id="toast">Entering the Meadow üåº</div>
  </div>

  <script>
// Embedded character images (Base64)
const PETS = {
  add: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABVYAAAOICAYAAADp1ZsYAAA...", 
  sub: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABVYAAAOICAYAAADp1ZsYBBB...", 
  mul: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABVYAAAOICAYAAADp1ZsYCCC...", 
  div: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABVYAAAOICAYAAADp1ZsYDDD..."
};

// Forest scenes
const SCENES = [
  {min:0,  cls:'scene-0', toast:'Entering the Meadow üåº'},
  {min:5,  cls:'scene-1', toast:'At the Forest Edge üåø'},
  {min:10, cls:'scene-2', toast:'Into the Deep Forest üå≤'},
  {min:15, cls:'scene-3', toast:'Found the Waterfall üíß'},
  {min:20, cls:'scene-4', toast:'Treasure Grove discovered! üíé'},
];

const encMsgs = ["Great job! üéâ","You're a math star! ‚≠ê","Keep going! üöÄ","Wow, super fast! ‚ö°","Fantastic! üêæ"];

const el = (id)=>document.getElementById(id);
const op=el('op'), diff=el('diff'), timeSel=el('time'), player=el('player');
const pet=el('pet'), q=el('q'), ans=el('ans'), enc=el('enc');
const t=el('t'), s=el('s'), fill=el('fill'), toast=el('toast'), lb=el('lb');

let a1=0,a2=0,correct=0,score=0,timeLeft=0,timer=null;

function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function setPet(){ pet.src = PETS[op.value]; }
function sceneByScore(sc){
  let idx=0; for(let i=0;i<SCENES.length;i++) if(sc>=SCENES[i].min) idx=i;
  document.body.className = SCENES[idx].cls;
  toast.textContent = SCENES[idx].toast;
  toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1500);
}
function confetti(){
  for(let i=0;i<22;i++){
    const c=document.createElement('div'); 
    c.className='confetti';
    c.style.left=`${50+(Math.random()*40-20)}%`;
    c.style.backgroundColor=`hsl(${Math.random()*360},100%,50%)`;
    c.style.transform=`rotate(${Math.random()*360}deg)`;
    document.getElementById('card').appendChild(c); 
    setTimeout(()=>c.remove(),1400);
  }
}

function genQ(){
  let min,max;
  if(op.value==='mul' || op.value==='div'){min=1;max=15;}
  else { 
    if(diff.value==='easy'){min=1;max=9} 
    else if(diff.value==='medium'){min=10;max=99} 
    else {min=100;max=999} 
  }
  a1 = randInt(min,max);
  if(op.value==='mul'){
    a2 = randInt(min,max);
  } else if(op.value==='div'){
    a2 = randInt(1,15);
    a1 = a2 * randInt(1,15); // ensure whole number
  } else {
    a2 = randInt(min,max);
    if(op.value==='sub' && a1<a2){[a1,a2]=[a2,a1];}
  }
  switch(op.value){
    case 'add': correct=a1+a2; q.textContent=`${a1} + ${a2} = ?`; break;
    case 'sub': correct=a1-a2; q.textContent=`${a1} ‚àí ${a2} = ?`; break;
    case 'mul': correct=a1*a2; q.textContent=`${a1} √ó ${a2} = ?`; break;
    case 'div': correct=a1/a2; q.textContent=`${a1} √∑ ${a2} = ?`; break;
  }
  setPet();
}

function start(){
  if(!player.value.trim()){alert("Please enter your name."); return;}
  score=0; s.textContent=score; fill.style.width='0%'; enc.textContent='';
  sceneByScore(0);
  timeLeft=parseInt(timeSel.value); t.textContent=timeLeft;
  clearInterval(timer);
  timer=setInterval(()=>{
    timeLeft--; t.textContent=timeLeft; 
    if(timeLeft<=0){clearInterval(timer); end();}
  },1000);
  genQ(); ans.focus();
}
function submit(){
  const v=parseInt(ans.value); 
  if(!Number.isFinite(v)) return;
  if(v===correct){
    score++; 
    s.textContent=score; 
    enc.textContent=encMsgs[Math.floor(Math.random()*encMsgs.length)];
    fill.style.width = ((score%10)*10)+'%';
    pet.style.transform='translateY(-6px) scale(1.04)'; 
    setTimeout(()=>pet.style.transform='',180);
    confetti(); 
    sceneByScore(score);
  } else {
    enc.textContent="Oops! Try again! üí™";
    pet.style.transform='rotate(-4deg)'; 
    setTimeout(()=>pet.style.transform='',160);
  }
  ans.value=''; 
  if(timeLeft>0) genQ();
}

function end(){
  q.textContent = "‚è∞ Time‚Äôs up!";
  enc.textContent = `${player.value} scored ${score} points!`;
  saveScore(player.value||'Player', score);
  loadLB();
}

function saveScore(name,score){
  let list = JSON.parse(localStorage.getItem('monkeyLB')||'[]');
  list.push({name,score});
  list.sort((a,b)=>b.score-a.score); 
  list=list.slice(0,10);
  localStorage.setItem('monkeyLB', JSON.stringify(list));
}

function loadLB(){
  const list = JSON.parse(localStorage.getItem('monkeyLB')||'[]');
  lb.innerHTML = list.map((e,i)=>`<tr><td>${i+1}</td><td>${e.name}</td><td>${e.score}</td></tr>`).join('');
}

document.getElementById('start').addEventListener('click', start);
document.getElementById('submit').addEventListener('click', submit);
document.getElementById('ans').addEventListener('keypress', e=>{ if(e.key==='Enter') submit(); });
loadLB(); 
setPet();
</script>
</body>
</html>
